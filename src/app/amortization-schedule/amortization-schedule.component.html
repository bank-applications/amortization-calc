<div class="container">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Financial-Year</th>
        <th>Starting Balance</th>
        <th>Interest</th>
        <th>Principal</th>
        <th>EMI</th>
        <th>PartPayment</th>
        <th>Ending Balance</th>
        <th>Action</th> <!-- New column for the collapse/expand action -->

      </tr>
    </thead>
    <tbody>
      @for(yearItem of yearlyTotals; track $index) {
      <tr>
        <td>{{ yearItem.year }}</td>
        <td>{{ yearItem.startingBalance.toFixed(0) }}</td>
        <td>{{ yearItem.totalInterestPaid.toFixed(0)}}</td>
        <td>{{ yearItem.totalPrincipalPaid.toFixed(0) }}</td>
        <td>{{ yearItem.totalEmiPaid.toFixed(0) }}</td>
        <td>{{ yearItem.totalPartPaymentPaid.toFixed(0) }}</td>
        <td>{{ yearItem.endingBalance.toFixed(0)}}</td>
        <td (click)="toggleMonthlyData($index)" class="action-cell">
          <i [ngClass]="expandedIndex === $index ? 'collapse-icon' : 'expand-icon'"></i> <!-- Toggle icon -->
        </td>
      </tr>
      <tr *ngIf="expandedIndex === $index" class="monthly-data-row">
        <td colspan="8"> <!-- colspan updated to include the action column -->
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>#</th>
                <th>Month</th>
                <th>Starting Balance</th>
                <th>Interest</th>
                <th>Principal</th>
                <th>EMI</th>
                <th>PartPayment</th>
                <th>Ending Balance</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let monthItem of yearItem.months">
                <td>{{ monthItem.month }}</td>
                <td>{{ monthItem.monthName }}</td>
                <td>{{ monthItem.startingBalance.toFixed(0) }}</td>
                <td>{{ monthItem.interestPaid.toFixed(0) }}</td>
                <td>{{ monthItem.principalPaid.toFixed(0) }}</td>
                <td>{{ monthItem.emiPaid.toFixed(0) }}</td>
                <td>{{ monthItem.partPaymentPaid.toFixed(0) }}</td>
                <td>{{ monthItem.endingBalance.toFixed(0) }}</td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>

      }

    </tbody>

  </table>

  <!-- @for(year of yearlyTotals; track $index) {
  <div>
    <h3>
      Financial Year {{ year.year }}
      <button class="btn btn-primary btn-sm float-end" (click)="toggleCollapse(year.year)">
        {{ collapsedYears[year.year] ? 'Show Details' : 'Hide Details' }}
      </button>
    </h3>
    <div [ngClass]="{'collapse': collapsedYears[year.year]}">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>#</th>
            <th>Month</th>
            <th>Starting Balance</th>
            <th>Principal</th>
            <th>Interest</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
          @for(payment of schedule; track $index) {
            <tr>
              <td>{{ payment.month }}</td>
              <td>{{ payment.monthName }}</td>
              <td>{{ payment.startingBalance }}</td>
              <td>{{ payment.principal }}</td>
              <td>{{ payment.interest }}</td>
              <td>{{ payment.balance }}</td>
            </tr>
          } -->

  <!-- </tbody>
      </table>
      <div class="year-summary">
        <p><strong>Total Principal:</strong> {{ year.totalPrincipal }}</p>
        <p><strong>Total Interest:</strong> {{ year.totalInterest }}</p>
        <p><strong>Starting Balance:</strong> {{ year.startingBalance }}</p>
        <p><strong>Ending Balance:</strong> {{ year.endingBalance }}</p>
      </div>
    </div>
  </div>
  } -->
</div>